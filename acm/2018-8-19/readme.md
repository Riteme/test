#### D. Rikka with Prefix Sum

**题意**　给定一个长度为 $n$ 初始值均为 0 的序列 $A[1..n]$，有 $q$ 次操作，操作为以下三种之一：

* 给定区间 $[L,\,R]$ 和 $v$，将 $A[L..R]$ 内的所有元素全部加上 $v$。
* 对序列 $A$ 做一次前缀和。
* 给定区间 $[L,\,R]$，求出 $A[L..R]$ 内所有元素之和对 998244353 取模后的值。

$n,\,q \leqslant 10^5$，其中第三种操作最多只有 500 次。

**题解**　由于第三种操作非常少，所以考虑暴力一点的方法：单独考虑每次区间修改操作对查询的贡献。修改和查询之间可能隔了几次前缀和操作，所以要记录每个修改操作是加到 $A$ 的几次前缀和中。注意到单点对区间的贡献很好计算，就是一个简单的组合数：设向下走了 $h$ 步，假设单点在0，区间为 $[l,\,r]$，那么贡献次数为 ${r + 1 \choose h + 1} - {l \choose h + 1}$。

所以考虑将区间修改拆成单点修改：即差分操作。这样就可以计算一个区间修改对区间查询的贡献了。

<br />

#### F. Rikka with Line Graph

**题意**　首先定义无向带权的图 $G$ 的线图 $L(G)$：将图 $G$ 中的每条边当做一个点，构成 $L(G)$ 的点集；$L(G)$ 中两个点 $u$ 和 $v$ 如果有边相连，当且仅当 $u$ 和 $v$ 在图 $G$ 中对应的边有公共点，并且这条边的边权为 $u$ 和 $v$ 在图 $G$ 的边权之和。

现在给定一个 $n$ 个点的无向带权完全图 $G$，现在需要计算 $L(G)$ 中所有点对间最短路长度之和对 998244353 取模后的值。$n \leqslant 500$。

**题解**　首先从图 $G$ 的视角来观察一下 $L(G)$ 中一条路径的样子：就是从一条边到另外一条边的路径，但除了出发和结束的边，其余的边的边权都算了两遍。

因此就很容易有一个 $\Theta(n^4)$ 的算法：枚举起点和终点的边，然后根据这两条边之间的最短距离来计算贡献。而这个最短距离是以起点的边的两个端点为源点的最短路。

考虑到 $G$ 是一张完全图，所以枚举的过程可以简化：我们只需要用双源最短路计算出起点边到所有点的最短距离。然后对于每个点，考虑有多少条出边会将它的最短路作为贡献。双源最短可以由两个点的最短路距离数组取最小值得到。直接枚举的时候需要使用排序，因此复杂度是 $O(n^3 \log n)$。

实际上可以进一步优化。因为最短路数组只有 $n$ 个，因此可以提前将这 $n$ 个数组排序，然后在枚举的时候使用归并排序即可。这样做的时间复杂度为 $\Theta(n^3)$。